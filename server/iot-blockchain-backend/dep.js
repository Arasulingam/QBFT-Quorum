const Web3 = require('web3');
require('dotenv').config();

const web3 = new Web3('ws://127.0.0.1:32000');

// REPLACE WITH YOUR COMPILED BYTECODE
const bytecode = '0x6080604052610dac6004556103e8600555348015601a575f5ffd5b50600380546001600160a01b031916331790556119048061003a5f395ff3fe608060405234801561000f575f5ffd5b50600436106100fb575f3560e01c8063933eb9ca11610093578063e7b4cac611610063578063e7b4cac614610260578063f242289214610273578063f28bb3cb14610286578063fbe6c0ea1461028f575f5ffd5b8063933eb9ca146101fd5780639b619e2114610210578063c78436d614610233578063d25c5b9f14610257575f5ffd5b806375a8a64b116100ce57806375a8a64b146101745780637a2a530d146101aa57806381a80dc2146101bf5780638da5cb5b146101d2575f5ffd5b8063161601b9146100ff5780634869fe26146101285780636f6dfeb01461014c5780636fe3c2b214610161575b5f5ffd5b61011261010d366004611224565b6102a2565b60405161011f919061127a565b60405180910390f35b61013b610136366004611325565b610511565b60405161011f959493929190611345565b61015f61015a366004611426565b610679565b005b61015f61016f366004611325565b610837565b61019c610182366004611325565b6001600160a01b03165f9081526001602052604090205490565b60405190815260200161011f565b6101b2610884565b60405161011f919061149a565b61015f6101cd3660046114e5565b6108e4565b6003546101e5906001600160a01b031681565b6040516001600160a01b03909116815260200161011f565b61015f61020b366004611325565b610bc9565b61022361021e366004611325565b610c82565b60405161011f94939291906114fc565b610246610241366004611224565b610ea9565b60405161011f959493929190611537565b61019c60045481565b61013b61026e366004611325565b611004565b6101e56102813660046114e5565b611143565b61019c60055481565b61015f61029d36600461157c565b61116b565b6001600160a01b0382165f9081526001602052604090208054606091908315806102cb57508084115b156102d4578093505b5f8467ffffffffffffffff8111156102ee576102ee611387565b60405190808252806020026020018201604052801561035057816020015b61033d6040518060a001604052805f81526020015f815260200160608152602001606081526020015f151581525090565b81526020019060019003908161030c5790505b5090505f5b8581101561050557838161036988866115b0565b61037391906115c3565b81548110610383576103836115d6565b905f5260205f2090600502016040518060a00160405290815f8201548152602001600182015481526020016002820180546103bd906115ea565b80601f01602080910402602001604051908101604052809291908181526020018280546103e9906115ea565b80156104345780601f1061040b57610100808354040283529160200191610434565b820191905f5260205f20905b81548152906001019060200180831161041757829003601f168201915b5050505050815260200160038201805461044d906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610479906115ea565b80156104c45780601f1061049b576101008083540402835291602001916104c4565b820191905f5260205f20905b8154815290600101906020018083116104a757829003601f168201915b50505091835250506004919091015460ff16151560209091015282518390839081106104f2576104f26115d6565b6020908102919091010152600101610355565b50925050505b92915050565b6001600160a01b0381165f9081526020819052604081206002810154600382015460048301548354606095869590948594859492938493600185019360ff169291859061055d906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610589906115ea565b80156105d45780601f106105ab576101008083540402835291602001916105d4565b820191905f5260205f20905b8154815290600101906020018083116105b757829003601f168201915b505050505094508380546105e7906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610613906115ea565b801561065e5780601f106106355761010080835404028352916020019161065e565b820191905f5260205f20905b81548152906001019060200180831161064157829003601f168201915b50505050509350955095509550955095505091939590929450565b6003546001600160a01b031633146106ac5760405162461bcd60e51b81526004016106a390611622565b60405180910390fd5b6001600160a01b0383165f9081526020819052604090206002015460ff16156107175760405162461bcd60e51b815260206004820152601960248201527f44657669636520616c726561647920726567697374657265640000000000000060448201526064016106a3565b6040805160a08101825283815260208082018490526001828401524260608301525f608083018190526001600160a01b038716815290819052919091208151819061076290826116ae565b506020820151600182019061077790826116ae565b506040828101516002838101805460ff1916921515929092179091556060840151600384015560809093015160049092019190915581546001810183555f929092527f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace90910180546001600160a01b0319166001600160a01b03861690811790915590517f25bec5442671a5d594ede63d811665f791f5152b85d1ca34a8c1630a11af352a9061082a9085908590611769565b60405180910390a2505050565b6003546001600160a01b031633146108615760405162461bcd60e51b81526004016106a390611622565b6001600160a01b03165f908152602081905260409020600201805460ff19169055565b606060028054806020026020016040519081016040528092919081815260200182805480156108da57602002820191905f5260205f20905b81546001600160a01b031681526001909101906020018083116108bc575b5050505050905090565b335f9081526020819052604090206002015460ff1661093d5760405162461bcd60e51b815260206004820152601560248201527411195d9a58d9481b9bdd08185d5d1a1bdc9a5e9959605a1b60448201526064016106a3565b335f90815260208181526040808320815160a0810183524281529283018590528054909392918201908490610971906115ea565b80601f016020809104026020016040519081016040528092919081815260200182805461099d906115ea565b80156109e85780601f106109bf576101008083540402835291602001916109e8565b820191905f5260205f20905b8154815290600101906020018083116109cb57829003601f168201915b50505050508152602001836001018054610a01906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610a2d906115ea565b8015610a785780601f10610a4f57610100808354040283529160200191610a78565b820191905f5260205f20905b815481529060010190602001808311610a5b57829003601f168201915b505050918352505060016020918201819052335f90815281835260408082208054808501825590835291849020855160059093020191825592840151918101919091559082015191925082916002820190610ad390826116ae565b5060608201516003820190610ae890826116ae565b50608091909101516004918201805460ff19169115159190911790554290830181905560405133917fc94354ee0e5306728f7471d0b28b5193e3e7f9a7fada47cd1411b0b1d96a00e091610b40918691889190611815565b60405180910390a2600454831315610b865760405133907f4d2fd1292b4a0d8d9d55cbada8b44eac3c1f64c8ec6771d182db5b935c7134819061082a9085908790611839565b600554831215610bc45760405133907f4d2fd1292b4a0d8d9d55cbada8b44eac3c1f64c8ec6771d182db5b935c7134819061082a9085908790611884565b505050565b6003546001600160a01b03163314610bf35760405162461bcd60e51b81526004016106a390611622565b6001600160a01b0381165f9081526020819052604081208054610c15906115ea565b905011610c5c5760405162461bcd60e51b815260206004820152601560248201527411195d9a58d9481b9bdd081c9959da5cdd195c9959605a1b60448201526064016106a3565b6001600160a01b03165f908152602081905260409020600201805460ff19166001179055565b6001600160a01b0381165f908152602081905260408120600201548190606090819060ff16610ce65760405162461bcd60e51b815260206004820152601060248201526f11195d9a58d9481b9bdd08199bdd5b9960821b60448201526064016106a3565b6001600160a01b0385165f9081526001602052604090208054610d435760405162461bcd60e51b81526020600482015260156024820152744e6f2072656164696e677320617661696c61626c6560581b60448201526064016106a3565b80545f908290610d55906001906115b0565b81548110610d6557610d656115d6565b905f5260205f2090600502019050805f015481600101548260020183600301818054610d90906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610dbc906115ea565b8015610e075780601f10610dde57610100808354040283529160200191610e07565b820191905f5260205f20905b815481529060010190602001808311610dea57829003601f168201915b50505050509150808054610e1a906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610e46906115ea565b8015610e915780601f10610e6857610100808354040283529160200191610e91565b820191905f5260205f20905b815481529060010190602001808311610e7457829003601f168201915b50505050509050955095509550955050509193509193565b6001602052815f5260405f208181548110610ec2575f80fd5b905f5260205f2090600502015f9150915050805f015490806001015490806002018054610eee906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610f1a906115ea565b8015610f655780601f10610f3c57610100808354040283529160200191610f65565b820191905f5260205f20905b815481529060010190602001808311610f4857829003601f168201915b505050505090806003018054610f7a906115ea565b80601f0160208091040260200160405190810160405280929190818152602001828054610fa6906115ea565b8015610ff15780601f10610fc857610100808354040283529160200191610ff1565b820191905f5260205f20905b815481529060010190602001808311610fd457829003601f168201915b5050506004909301549192505060ff1685565b5f6020819052908152604090208054819061101e906115ea565b80601f016020809104026020016040519081016040528092919081815260200182805461104a906115ea565b80156110955780601f1061106c57610100808354040283529160200191611095565b820191905f5260205f20905b81548152906001019060200180831161107857829003601f168201915b5050505050908060010180546110aa906115ea565b80601f01602080910402602001604051908101604052809291908181526020018280546110d6906115ea565b80156111215780601f106110f857610100808354040283529160200191611121565b820191905f5260205f20905b81548152906001019060200180831161110457829003601f168201915b5050505060028301546003840154600490940154929360ff9091169290915085565b60028181548110611152575f80fd5b5f918252602090912001546001600160a01b0316905081565b6003546001600160a01b031633146111955760405162461bcd60e51b81526004016106a390611622565b8082136111fe5760405162461bcd60e51b815260206004820152603160248201527f48696768207468726573686f6c64206d757374206265206772656174657220746044820152701a185b881b1bddc81d1a1c995cda1bdb19607a1b60648201526084016106a3565b600491909155600555565b80356001600160a01b038116811461121f575f5ffd5b919050565b5f5f60408385031215611235575f5ffd5b61123e83611209565b946020939093013593505050565b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b5f602082016020835280845180835260408501915060408160051b8601019250602086015f5b8281101561131957603f1987860301845281518051865260208101516020870152604081015160a060408801526112da60a088018261124c565b9050606082015187820360608901526112f3828261124c565b6080938401511515989093019790975250945060209384019391909101906001016112a0565b50929695505050505050565b5f60208284031215611335575f5ffd5b61133e82611209565b9392505050565b60a081525f61135760a083018861124c565b8281036020840152611369818861124c565b95151560408401525050606081019290925260809091015292915050565b634e487b7160e01b5f52604160045260245ffd5b5f82601f8301126113aa575f5ffd5b813567ffffffffffffffff8111156113c4576113c4611387565b604051601f8201601f19908116603f0116810167ffffffffffffffff811182821017156113f3576113f3611387565b60405281815283820160200185101561140a575f5ffd5b816020850160208301375f918101602001919091529392505050565b5f5f5f60608486031215611438575f5ffd5b61144184611209565b9250602084013567ffffffffffffffff81111561145c575f5ffd5b6114688682870161139b565b925050604084013567ffffffffffffffff811115611484575f5ffd5b6114908682870161139b565b9150509250925092565b602080825282518282018190525f918401906040840190835b818110156114da5783516001600160a01b03168352602093840193909201916001016114b3565b509095945050505050565b5f602082840312156114f5575f5ffd5b5035919050565b848152836020820152608060408201525f61151a608083018561124c565b828103606084015261152c818561124c565b979650505050505050565b85815284602082015260a060408201525f61155560a083018661124c565b8281036060840152611567818661124c565b91505082151560808301529695505050505050565b5f5f6040838503121561158d575f5ffd5b50508035926020909101359150565b634e487b7160e01b5f52601160045260245ffd5b8181038181111561050b5761050b61159c565b8082018082111561050b5761050b61159c565b634e487b7160e01b5f52603260045260245ffd5b600181811c908216806115fe57607f821691505b60208210810361161c57634e487b7160e01b5f52602260045260245ffd5b50919050565b60208082526021908201527f4f6e6c79206f776e65722063616e2063616c6c20746869732066756e6374696f6040820152603760f91b606082015260800190565b601f821115610bc457805f5260205f20601f840160051c810160208510156116885750805b601f840160051c820191505b818110156116a7575f8155600101611694565b5050505050565b815167ffffffffffffffff8111156116c8576116c8611387565b6116dc816116d684546115ea565b84611663565b6020601f82116001811461170e575f83156116f75750848201515b5f19600385901b1c1916600184901b1784556116a7565b5f84815260208120601f198516915b8281101561173d578785015182556020948501946001909201910161171d565b508482101561175a57868401515f19600387901b60f8161c191681555b50505050600190811b01905550565b604081525f61177b604083018561124c565b828103602084015261178d818561124c565b95945050505050565b5f81546117a2816115ea565b8085526001821680156117bc57600181146117d85761180c565b60ff1983166020870152602082151560051b870101935061180c565b845f5260205f205f5b838110156118035781546020828a0101526001820191506020810190506117e1565b87016020019450505b50505092915050565b606081525f6118276060830186611796565b60208301949094525060400152919050565b606081525f61184b6060830185611796565b8360208401528281036040840152601081526f484947485f54454d504552415455524560801b6020820152604081019150509392505050565b606081525f6118966060830185611796565b8360208401528281036040840152600f81526e4c4f575f54454d504552415455524560881b602082015260408101915050939250505056fea264697066735822122017df5db50953621cd4f46ce474d3f378034da6cffda851b3260866d24bdb489a64736f6c634300081e0033'; // Your full bytecode

const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"deviceAddress","type":"address"},{"indexed":false,"internalType":"string","name":"deviceId","type":"string"},{"indexed":false,"internalType":"int256","name":"temperature","type":"int256"},{"indexed":false,"internalType":"string","name":"alertType","type":"string"}],"name":"AlertTriggered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"deviceAddress","type":"address"},{"indexed":false,"internalType":"string","name":"deviceId","type":"string"},{"indexed":false,"internalType":"string","name":"location","type":"string"}],"name":"DeviceRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"deviceAddress","type":"address"},{"indexed":false,"internalType":"string","name":"deviceId","type":"string"},{"indexed":false,"internalType":"int256","name":"temperature","type":"int256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"TemperatureRecorded","type":"event"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"}],"name":"authorizeDevice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"deviceAddresses","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"deviceReadings","outputs":[{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"int256","name":"temperature","type":"int256"},{"internalType":"string","name":"deviceId","type":"string"},{"internalType":"string","name":"location","type":"string"},{"internalType":"bool","name":"isValid","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"devices","outputs":[{"internalType":"string","name":"deviceId","type":"string"},{"internalType":"string","name":"location","type":"string"},{"internalType":"bool","name":"isAuthorized","type":"bool"},{"internalType":"uint256","name":"registeredAt","type":"uint256"},{"internalType":"uint256","name":"lastUpdate","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllDevices","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"}],"name":"getDeviceInfo","outputs":[{"internalType":"string","name":"deviceId","type":"string"},{"internalType":"string","name":"location","type":"string"},{"internalType":"bool","name":"isAuthorized","type":"bool"},{"internalType":"uint256","name":"registeredAt","type":"uint256"},{"internalType":"uint256","name":"lastUpdate","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"},{"internalType":"uint256","name":"limit","type":"uint256"}],"name":"getDeviceReadings","outputs":[{"components":[{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"int256","name":"temperature","type":"int256"},{"internalType":"string","name":"deviceId","type":"string"},{"internalType":"string","name":"location","type":"string"},{"internalType":"bool","name":"isValid","type":"bool"}],"internalType":"struct IoTTemperatureMonitor.TemperatureReading[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"}],"name":"getLatestReading","outputs":[{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"int256","name":"temperature","type":"int256"},{"internalType":"string","name":"deviceId","type":"string"},{"internalType":"string","name":"location","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"}],"name":"getReadingCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"highTempThreshold","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lowTempThreshold","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"int256","name":"temperature","type":"int256"}],"name":"recordTemperature","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"},{"internalType":"string","name":"deviceId","type":"string"},{"internalType":"string","name":"location","type":"string"}],"name":"registerDevice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"deviceAddress","type":"address"}],"name":"revokeDevice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"int256","name":"high","type":"int256"},{"internalType":"int256","name":"low","type":"int256"}],"name":"updateThresholds","outputs":[],"stateMutability":"nonpayable","type":"function"}]; // Your ABI

async function deploy() {
  const account = web3.eth.accounts.privateKeyToAccount(process.env.OWNER_PRIVATE_KEY);
  const contract = new web3.eth.Contract(abi);
  
  const deployTx = await contract.deploy({ data: bytecode }).send({
    from: account.address,
    gas: 10000000,
    gasPrice: '0'
  });
  
  console.log('Contract deployed at:', deployTx.options.address);
}

deploy();
